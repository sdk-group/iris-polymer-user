<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iris-polymer-importer/iris-importer.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../../bower_components/iris-polymer-api/iris-api.html">

<dom-module id="iris-usercard">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
      }
      
      .online-status.online {
        color: var(--paper-light-green-700);
      }
      
      .online-status.offline {
        color: var(--paper-grey-500);
      }
      
      .title {
        min-height: 20px;
      }
      
      .online-status {
        width: 13px;
      }
      
      .fields {
        padding-left: 15px;
      }
      
      iron-icon {
        margin-top: -1px;
      }
      
      .actions >::content paper-button {
        float: right;
      }
      
      .bottom.title {
        font-size: 12px;
      }
      
      #user-icon {
        border-radius: 50%;
        padding: 14px;
      }
      
      #user-icon.blue {
        background-color: var(--paper-light-blue-600);
      }
      
      #user-icon.beige {
        background-color: #F4EBE0;
      }
      
      #user-icon.online {
        box-shadow: 0 0 8px 4px rgba(0, 176, 0, 0.75);
      }
    </style>

    <iris-currentuser id="user" is-logged="{{logged_in}}" short-name="{{title}}"></iris-currentuser>
    <paper-toolbar>
      <paper-icon-button icon="menu" on-tap="menuAction"></paper-icon-button>
      <div id="user-icon" class="offline beige">
        <iron-icon icon="social:person"></iron-icon>
      </div>
      <div class="fields ">
        <div class="middle title">
          <span class="field">[[title]]</span>
        </div>
        <div class="bottom title">
          <template is="dom-if" if="[[logged_in]]">
            <iron-icon class="online-status online" icon="icons:radio-button-checked"></iron-icon> в сети
          </template>
          <template is="dom-if" if="[[!logged_in]]">
            <iron-icon class="online-status offline" icon="icons:radio-button-unchecked"></iron-icon> не в сети
          </template>
        </div>
      </div>
      <div class="actions flex" hidden$="[[!logged_in]]" on-tap="actionsClick">
        <content></content>
      </div>
    </paper-toolbar>

  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'iris-usercard',
        properties: {},
        actionsClick(event) {
          var target = event.target;
          while (target && target !== this) {
            if (target.hasAttribute) {
              if (target.hasAttribute('user-logout')) {
                this.$.user.logout()
                  .then(() => {
                    page('/');
                  });
                break;
              } else if (target.hasAttribute('user-break')) {
                this.$.user.takeBreak();
                break;
              }
            }
            target = target.parentNode;
          }
        },
        menuAction() {
          this.fire('menu');
        }
      });
    })();
  </script>

</dom-module>